from django.test import TestCase
from daily.models import (
    State,
    Test,
    TestResult,
    HospitalStatus,
    Graph
)

class DailyTestCase(TestCase):
    def setUp(self):
        state = State(
            name       ='Alaska',
            populations=737438,
            is_deleted =False,
        )
        state.save()

        test = Test(
            state_id  =state.id,
            count     =50,
            is_deleted=False,
        )
        test.save()

        test_result = TestResult(
            test_id             =test.id,
            confirmed_growth    =10,
            confirmed           =12,
            confirmed_per_capita=11,
            positive_percent    =14,
            is_deleted          =False,
        )
        test_result.save()

        hospital_status = HospitalStatus(
            state_id    =state.id,
            hospitalized=50,
            death       =14,
            is_deleted  =False,
        )
        hospital_status.save()

        graph = Graph(
            state_id   =state.id,
            trend_graph='<svg height="30" preserveaspectratio="none" viewbox="0 0 240 60" width="100"><g><path d="M2 2 C 6.538461538461538 2 15.615384615384615 6.489144553720535 20.153846153846153 6.489144553720535 C 24.692307692307693 6.489144553720535 33.76923076923077 6.489144553720535 38.30769230769231 6.489144553720535 C 42.84615384615385 6.489144553720535 51.92307692307692 4.743366116162557 56.46153846153846 4.743366116162557 C 61 4.743366116162557 70.07692307692308 6.4060122471701595 74.61538461538461 6.4060122471701595 C 79.15384615384616 6.4060122471701595 88.23076923076923 20.372239747634072 92.76923076923077 20.372239747634072 C 97.3076923076923 20.372239747634072 106.38461538461539 24.861384301354608 110.92307692307692 24.861384301354608 C 115.46153846153845 24.861384301354608 124.53846153846153 29.475227314900724 129.07692307692307 29.475227314900724 C 133.6153846153846 29.475227314900724 142.69230769230768 29.810953937508035 147.23076923076923 29.810953937508035 C 151.76923076923077 29.810953937508035 160.84615384615384 32.800519576915946 165.3846153846154 32.800519576915946 C 169.92307692307693 32.800519576915946 179 36.447004841512175 183.53846153846155 36.447004841512175 C 188.0769230769231 36.447004841512175 197.15384615384613 44.8131378734459 201.69230769230768 44.8131378734459 C 206.23076923076923 44.8131378734459 215.3076923076923 56.00828848889713 219.84615384615384 56.00828848889713 C 224.3846153846154 56.00828848889713 233.46153846153845 58 238 58 L238 58 2 58 2 2" style="stroke: rgb(92, 179, 170); stroke-width: 0; fill-opacity: 0.1; fill: none;"></path><path d="M2 2 C 6.538461538461538 2 15.615384615384615 6.489144553720535 20.153846153846153 6.489144553720535 C 24.692307692307693 6.489144553720535 33.76923076923077 6.489144553720535 38.30769230769231 6.489144553720535 C 42.84615384615385 6.489144553720535 51.92307692307692 4.743366116162557 56.46153846153846 4.743366116162557 C 61 4.743366116162557 70.07692307692308 6.4060122471701595 74.61538461538461 6.4060122471701595 C 79.15384615384616 6.4060122471701595 88.23076923076923 20.372239747634072 92.76923076923077 20.372239747634072 C 97.3076923076923 20.372239747634072 106.38461538461539 24.861384301354608 110.92307692307692 24.861384301354608 C 115.46153846153845 24.861384301354608 124.53846153846153 29.475227314900724 129.07692307692307 29.475227314900724 C 133.6153846153846 29.475227314900724 142.69230769230768 29.810953937508035 147.23076923076923 29.810953937508035 C 151.76923076923077 29.810953937508035 160.84615384615384 32.800519576915946 165.3846153846154 32.800519576915946 C 169.92307692307693 32.800519576915946 179 36.447004841512175 183.53846153846155 36.447004841512175 C 188.0769230769231 36.447004841512175 197.15384615384613 44.8131378734459 201.69230769230768 44.8131378734459 C 206.23076923076923 44.8131378734459 215.3076923076923 56.00828848889713 219.84615384615384 56.00828848889713 C 224.3846153846154 56.00828848889713 233.46153846153845 58 238 58" style="stroke: rgb(92, 179, 170); stroke-width: 2; stroke-linejoin: round; stroke-linecap: round; fill: none;"></path></g></svg><div>-40.6%</div>',
            gap_graph  ='<svg height="30" preserveaspectratio="none" viewbox="0 0 240 60" width="100"><g><path d="M2 38.95227595520338 C 5.105263157894736 38.95227595520338 11.31578947368421 37.006685322818264 14.421052631578947 37.006685322818264 C 17.526315789473685 37.006685322818264 23.736842105263158 37.34317688500777 26.842105263157894 37.34317688500777 C 29.94736842105263 37.34317688500777 36.1578947368421 37.34317688500777 39.26315789473684 37.34317688500777 C 42.368421052631575 37.34317688500777 48.578947368421055 39.141547629101936 51.68421052631579 39.141547629101936 C 54.78947368421053 39.141547629101936 61 42.174054879529095 64.10526315789474 42.174054879529095 C 67.21052631578948 42.174054879529095 73.42105263157895 58.00000000000001 76.52631578947368 58.00000000000001 C 79.63157894736842 58.00000000000001 85.84210526315789 52.739869847310125 88.94736842105263 52.739869847310125 C 92.05263157894737 52.739869847310125 98.26315789473684 36.35434221228099 101.36842105263158 36.35434221228099 C 104.47368421052632 36.35434221228099 110.68421052631578 36.037941066774025 113.78947368421052 36.037941066774025 C 116.89473684210526 36.037941066774025 123.10526315789473 34.12190104217365 126.21052631578947 34.12190104217365 C 129.3157894736842 34.12190104217365 135.52631578947367 25.454542564924953 138.6315789473684 25.454542564924953 C 141.73684210526315 25.454542564924953 147.94736842105263 20.22051109450955 151.05263157894737 20.22051109450955 C 154.1578947368421 20.22051109450955 160.36842105263156 9.850639153423435 163.4736842105263 9.850639153423435 C 166.57894736842104 9.850639153423435 172.78947368421052 8.24508967753508 175.89473684210526 8.24508967753508 C 179 8.24508967753508 185.21052631578945 4.691959144288201 188.3157894736842 4.691959144288201 C 191.42105263157893 4.691959144288201 197.6315789473684 2 200.73684210526315 2 C 203.8421052631579 2 210.05263157894737 2.7733955914096033 213.1578947368421 2.7733955914096033 C 216.26315789473685 2.7733955914096033 222.4736842105263 3.1746750932570573 225.57894736842104 3.1746750932570573 C 228.68421052631578 3.1746750932570573 234.89473684210526 10.554847588892843 238 10.554847588892843 L238 58 2 58 2 38.95227595520338" style="stroke: rgb(92, 179, 170); stroke-width: 0; fill-opacity: 0.1; fill: none;"></path><path d="M2 38.95227595520338 C 5.105263157894736 38.95227595520338 11.31578947368421 37.006685322818264 14.421052631578947 37.006685322818264 C 17.526315789473685 37.006685322818264 23.736842105263158 37.34317688500777 26.842105263157894 37.34317688500777 C 29.94736842105263 37.34317688500777 36.1578947368421 37.34317688500777 39.26315789473684 37.34317688500777 C 42.368421052631575 37.34317688500777 48.578947368421055 39.141547629101936 51.68421052631579 39.141547629101936 C 54.78947368421053 39.141547629101936 61 42.174054879529095 64.10526315789474 42.174054879529095 C 67.21052631578948 42.174054879529095 73.42105263157895 58.00000000000001 76.52631578947368 58.00000000000001 C 79.63157894736842 58.00000000000001 85.84210526315789 52.739869847310125 88.94736842105263 52.739869847310125 C 92.05263157894737 52.739869847310125 98.26315789473684 36.35434221228099 101.36842105263158 36.35434221228099 C 104.47368421052632 36.35434221228099 110.68421052631578 36.037941066774025 113.78947368421052 36.037941066774025 C 116.89473684210526 36.037941066774025 123.10526315789473 34.12190104217365 126.21052631578947 34.12190104217365 C 129.3157894736842 34.12190104217365 135.52631578947367 25.454542564924953 138.6315789473684 25.454542564924953 C 141.73684210526315 25.454542564924953 147.94736842105263 20.22051109450955 151.05263157894737 20.22051109450955 C 154.1578947368421 20.22051109450955 160.36842105263156 9.850639153423435 163.4736842105263 9.850639153423435 C 166.57894736842104 9.850639153423435 172.78947368421052 8.24508967753508 175.89473684210526 8.24508967753508 C 179 8.24508967753508 185.21052631578945 4.691959144288201 188.3157894736842 4.691959144288201 C 191.42105263157893 4.691959144288201 197.6315789473684 2 200.73684210526315 2 C 203.8421052631579 2 210.05263157894737 2.7733955914096033 213.1578947368421 2.7733955914096033 C 216.26315789473685 2.7733955914096033 222.4736842105263 3.1746750932570573 225.57894736842104 3.1746750932570573 C 228.68421052631578 3.1746750932570573 234.89473684210526 10.554847588892843 238 10.554847588892843" style="stroke: rgb(92, 179, 170); stroke-width: 2; stroke-linejoin: round; stroke-linecap: round; fill: none;"></path></g></svg>',
            is_deleted =False
        )
        graph.save()

    def tearDown(self):
        State.objects.all().delete()
        Test.objects.all().delete()
        TestResult.objects.all().delete()
        HospitalStatus.objects.all().delete()
        Graph.objects.all().delete()

    def test_daily_table_success(self):
        daily_table_response = self.client.get('/daily')
        self.assertEqual(daily_table_response.status_code, 200)

    def test_daily_chart_success(self):
        daily_chart_response = self.client.get('/daily/1,2,3')
        self.assertEqual(daily_chart_response.status_code, 200)

    def test_daily_table_fail(self):
        daily_table_response = self.client.get('/dailyy')
        self.assertEqual(daily_table_response.status_code, 404)

    def test_daily_chart_fail(self):
        daily_table_response = self.client.get('/daily/')
        self.assertEqual(daily_table_response.status_code, 404)